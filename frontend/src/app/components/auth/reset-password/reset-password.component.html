<div class="reset-password-container">
  <div class="reset-password-background">
    <div class="background-overlay"></div>
  </div>
  
  <div class="reset-password-content">
    <div class="reset-password-card-container">
      <mat-card class="reset-password-card">
        <mat-card-content>
          <!-- Logo Section -->
          <div class="logo-section">
            <div class="logo-icon">
              <mat-icon>fitness_center</mat-icon>
            </div>
            <h1 class="logo-text">FitPlanner</h1>
          </div>

          <!-- Loading State -->
          <div *ngIf="!tokenChecked" class="loading-state">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Verifying reset token...</p>
          </div>

          <!-- Invalid Token -->
          <div *ngIf="tokenChecked && !tokenValid" class="invalid-token">
            <div class="error-icon">
              <mat-icon>error_outline</mat-icon>
            </div>
            <h3>Invalid Reset Link</h3>
            <p>{{ serverError }}</p>
            
            <div class="error-actions">
              <button mat-raised-button color="primary" (click)="requestNewReset()" class="action-button">
                <mat-icon>refresh</mat-icon>
                Request New Reset
              </button>
              
              <button mat-stroked-button (click)="goToLogin()" class="action-button">
                <mat-icon>arrow_back</mat-icon>
                Back to Login
              </button>
            </div>
          </div>

          <!-- Success Message -->
          <div *ngIf="passwordReset" class="success-message">
            <div class="success-icon">
              <mat-icon>check_circle</mat-icon>
            </div>
            <h3>Password Reset Successfully!</h3>
            <p>Your password has been updated. You can now log in with your new password.</p>
            
            <div class="success-actions">
              <button mat-raised-button color="primary" (click)="goToLogin()" class="action-button">
                <mat-icon>login</mat-icon>
                Go to Login
              </button>
            </div>
          </div>

          <!-- Reset Password Form -->
          <div *ngIf="tokenChecked && tokenValid && !passwordReset" class="reset-form-section">
            <div class="user-info">
              <p class="welcome-text">Hi {{ userName }}, create a new password for your account.</p>
              <p class="email-text">{{ userEmail }}</p>
            </div>

            <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" class="reset-password-form">
              <!-- Server Error Alert -->
              <div *ngIf="serverError" class="server-error-alert">
                <mat-icon>error</mat-icon>
                <span>{{ serverError }}</span>
              </div>

              <div class="form-fields">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>New Password</mat-label>
                  <input matInput 
                         [type]="hidePassword ? 'password' : 'text'"
                         formControlName="password"
                         placeholder="Enter your new password"
                         (input)="clearServerErrors()"
                         [class.error]="resetPasswordForm.get('password')?.invalid && resetPasswordForm.get('password')?.touched">
                  <button mat-icon-button 
                          matSuffix 
                          type="button"
                          (click)="togglePasswordVisibility('password')"
                          [attr.aria-label]="'Hide password'"
                          [attr.aria-pressed]="hidePassword">
                    <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                  </button>
                  <mat-error *ngIf="(resetPasswordForm.get('password')?.invalid && resetPasswordForm.get('password')?.touched) || fieldErrors['password']">
                    {{ getErrorMessage('password') }}
                  </mat-error>
                </mat-form-field>

                <!-- Password Strength Indicator -->
                <div *ngIf="resetPasswordForm.get('password')?.value" class="password-strength">
                  <div class="strength-label">Password Strength:</div>
                  <div class="strength-indicator" [class]="getPasswordStrengthClass()">
                    <div class="strength-bar"></div>
                    <div class="strength-bar"></div>
                    <div class="strength-bar"></div>
                    <div class="strength-bar"></div>
                  </div>
                  <div class="strength-text" [class]="getPasswordStrengthClass()">
                    {{ getPasswordStrengthText() }}
                  </div>
                </div>

                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Confirm New Password</mat-label>
                  <input matInput 
                         [type]="hideConfirmPassword ? 'password' : 'text'"
                         formControlName="confirmPassword"
                         placeholder="Confirm your new password"
                         (input)="clearServerErrors()"
                         [class.error]="resetPasswordForm.get('confirmPassword')?.invalid && resetPasswordForm.get('confirmPassword')?.touched">
                  <button mat-icon-button 
                          matSuffix 
                          type="button"
                          (click)="togglePasswordVisibility('confirmPassword')"
                          [attr.aria-label]="'Hide password'"
                          [attr.aria-pressed]="hideConfirmPassword">
                    <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                  </button>
                  <mat-error *ngIf="(resetPasswordForm.get('confirmPassword')?.invalid && resetPasswordForm.get('confirmPassword')?.touched) || fieldErrors['confirmPassword']">
                    {{ getErrorMessage('confirmPassword') }}
                  </mat-error>
                </mat-form-field>
              </div>

              <!-- Password Requirements -->
              <div class="password-requirements">
                <h4>Password Requirements:</h4>
                <div class="requirement-list">
                  <div class="requirement-item" [class.met]="hasMinLength(resetPasswordForm.get('password')?.value || '')">
                    <mat-icon>{{ hasMinLength(resetPasswordForm.get('password')?.value || '') ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                    <span>At least 8 characters long</span>
                  </div>
                  <div class="requirement-item" [class.met]="hasLowercase(resetPasswordForm.get('password')?.value || '')">
                    <mat-icon>{{ hasLowercase(resetPasswordForm.get('password')?.value || '') ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                    <span>One lowercase letter</span>
                  </div>
                  <div class="requirement-item" [class.met]="hasUppercase(resetPasswordForm.get('password')?.value || '')">
                    <mat-icon>{{ hasUppercase(resetPasswordForm.get('password')?.value || '') ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                    <span>One uppercase letter</span>
                  </div>
                  <div class="requirement-item" [class.met]="hasNumber(resetPasswordForm.get('password')?.value || '')">
                    <mat-icon>{{ hasNumber(resetPasswordForm.get('password')?.value || '') ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                    <span>One number</span>
                  </div>
                  <div class="requirement-item" [class.met]="hasSpecialChar(resetPasswordForm.get('password')?.value || '')">
                    <mat-icon>{{ hasSpecialChar(resetPasswordForm.get('password')?.value || '') ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                    <span>One special character</span>
                  </div>
                </div>
              </div>

              <div class="form-actions">
                <button mat-raised-button 
                        color="primary" 
                        type="submit"
                        class="reset-button"
                        [disabled]="isLoading || resetPasswordForm.invalid">
                  <mat-spinner *ngIf="isLoading" diameter="20" class="button-spinner"></mat-spinner>
                  <mat-icon *ngIf="!isLoading">lock_reset</mat-icon>
                  <span *ngIf="!isLoading">Reset Password</span>
                  <span *ngIf="isLoading">Resetting...</span>
                </button>

                <button mat-stroked-button 
                        type="button"
                        class="back-button"
                        (click)="goToLogin()"
                        [disabled]="isLoading">
                  <mat-icon>arrow_back</mat-icon>
                  Back to Login
                </button>
              </div>
            </form>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Side Info Panel -->
    <div class="info-panel">
      <div class="info-content">
        <h2>Secure Password Reset</h2>
        <div class="security-tips">
          <div class="tip-item">
            <div class="tip-icon">
              <mat-icon>security</mat-icon>
            </div>
            <div class="tip-text">
              <h4>Strong Password</h4>
              <p>Create a strong password with a mix of letters, numbers, and special characters.</p>
            </div>
          </div>
          
          <div class="tip-item">
            <div class="tip-icon">
              <mat-icon>visibility_off</mat-icon>
            </div>
            <div class="tip-text">
              <h4>Keep It Private</h4>
              <p>Never share your password with anyone. We'll never ask for it via email or phone.</p>
            </div>
          </div>
          
          <div class="tip-item">
            <div class="tip-icon">
              <mat-icon>update</mat-icon>
            </div>
            <div class="tip-text">
              <h4>Regular Updates</h4>
              <p>Consider updating your password regularly to maintain account security.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>